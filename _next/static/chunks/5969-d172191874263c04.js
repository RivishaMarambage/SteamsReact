"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5969],{17313:(e,t,s)=>{s.d(t,{Xi:()=>c,av:()=>o,j7:()=>d,tU:()=>n});var a=s(95155),r=s(12115),i=s(60704),l=s(59434);let n=i.bL,d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.B8,{ref:t,className:(0,l.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r})});d.displayName=i.B8.displayName;let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.l9,{ref:t,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...r})});c.displayName=i.l9.displayName;let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.UC,{ref:t,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r})});o.displayName=i.UC.displayName},25969:(e,t,s)=>{s.d(t,{default:()=>R});var a=s(95155),r=s(90767),i=s(70831),l=s(83343),n=s(52873),d=s(83013),c=s(66695),o=s(68856),u=s(2160),f=s(94394),m=s(15121),h=s(97723),x=s(12115),p=s(30285),g=s(54165),b=s(85057),j=s(62523),v=s(59409),y=s(35317),N=s(87481),w=s(17313),C=s(30356);function R(){let{user:e,isUserLoading:t}=(0,r.Jd)(),s=(0,r.jt)(),R=(0,r.$e)(()=>e?(0,y.H9)(s,"users",e.uid):null,[e,s]),{data:F,isLoading:k}=(0,r.uN)(R),L=null==F?void 0:F.role,I="admin"===L,A=(0,r.$e)(()=>I?(0,y.rJ)(s,"users"):null,[s,I]),{data:B,isLoading:D}=(0,r.Ge)(A),{data:M,isLoading:U}=(0,r.Ge)("menu_items"),{toast:J}=(0,N.dj)(),[S,Y]=(0,x.useState)(!1),[G,P]=(0,x.useState)(null),[q,z]=(0,x.useState)("credit"),[E,V]=(0,x.useState)("fixed"),[H,O]=(0,x.useState)(0),[T,Z]=(0,x.useState)(""),$=t||k||I&&D||U,_=e=>{var t;P(e),Y(!0),O(0),Z((null==M||null==(t=M[0])?void 0:t.id)||""),z("credit"),V("fixed")},K=async()=>{if(!G||!s)return;let e=(0,y.H9)(s,"users",G.id),t={},a="";if("credit"===q){if(H<=0)return void J({variant:"destructive",title:"Invalid value",description:"Discount value must be greater than zero."});t={birthdayDiscountType:E,birthdayDiscountValue:H,birthdayFreebieMenuItemIds:[]},a="A ".concat("fixed"===E?"LKR ".concat(H):"".concat(H,"%")," discount has been added to their account.")}else{var r;if(!T)return void J({variant:"destructive",title:"No item selected",description:"Please select a menu item to give."});t={birthdayFreebieMenuItemIds:[T],birthdayDiscountType:null,birthdayDiscountValue:null};let e=null==M||null==(r=M.find(e=>e.id===T))?void 0:r.name;a="".concat(e," has been added to their account as a freebie.")}try{await (0,y.mZ)(e,t),J({title:"Reward Sent!",description:a})}catch(e){J({variant:"destructive",title:"Failed to give reward",description:e.message})}Y(!1)};if(!L||"staff"!==L&&"admin"!==L)return null;if($)return(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsx)(o.E,{className:"h-7 w-2/3"}),(0,a.jsx)(o.E,{className:"h-4 w-1/2"})]}),(0,a.jsx)(c.Wu,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.E,{className:"h-6 w-full"}),(0,a.jsx)(o.E,{className:"h-6 w-full"})]})})]});let W=new Date,X=(0,i.f)(W,7),Q=null==B?void 0:B.filter(e=>{if(!e.dateOfBirth)return!1;try{let t=(0,l.H)(e.dateOfBirth),s=new Date(t);s.setFullYear(W.getFullYear());let a=new Date(t);return a.setFullYear(W.getFullYear()+1),(0,n.v)(s,{start:W,end:X})||(0,n.v)(a,{start:W,end:X})}catch(e){return!1}}).sort((e,t)=>{let s=(0,l.H)(e.dateOfBirth),a=(0,l.H)(t.dateOfBirth);return s.setFullYear(W.getFullYear()),a.setFullYear(W.getFullYear()),s.getTime()-a.getTime()});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.Zp,{children:[(0,a.jsxs)(c.aR,{children:[(0,a.jsxs)(c.ZB,{className:"font-headline flex items-center gap-2",children:[(0,a.jsx)(u.A,{})," Upcoming Birthdays"]}),(0,a.jsx)(c.BT,{children:"Customers celebrating their birthday in the next 7 days. (Admin only feature)"})]}),(0,a.jsx)(c.Wu,{children:Q&&Q.length>0?(0,a.jsx)("ul",{className:"space-y-3",children:Q.map(e=>{let t=(0,l.H)(e.dateOfBirth),s=(0,d.GP)(t,"MMMM d"),r=e.birthdayDiscountValue||e.birthdayFreebieMenuItemIds&&e.birthdayFreebieMenuItemIds.length>0;return(0,a.jsxs)("li",{className:"flex justify-between items-center bg-muted/50 p-3 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-semibold",children:e.name}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground ml-2",children:s})]}),(0,a.jsx)(p.$,{size:"sm",variant:r?"secondary":"outline",onClick:()=>_(e),children:r?"Reward Given":"Give Reward"})]},e.id)})}):(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"admin"===L?"No upcoming birthdays in the next 7 days.":"Birthday list is only available for admins."})})]}),(0,a.jsx)(g.lG,{open:S,onOpenChange:Y,children:(0,a.jsxs)(g.Cf,{children:[(0,a.jsxs)(g.c7,{children:[(0,a.jsxs)(g.L3,{children:["Give Birthday Reward to ",null==G?void 0:G.name]}),(0,a.jsx)(g.rr,{children:"Choose a reward to send for their birthday."})]}),(0,a.jsxs)(w.tU,{value:q,onValueChange:e=>z(e),children:[(0,a.jsxs)(w.j7,{className:"grid w-full grid-cols-2",children:[(0,a.jsxs)(w.Xi,{value:"credit",children:[(0,a.jsx)(f.A,{className:"mr-2"})," Credit / Discount"]}),(0,a.jsxs)(w.Xi,{value:"free-item",children:[(0,a.jsx)(m.A,{className:"mr-2"})," Free Item"]})]}),(0,a.jsxs)(w.av,{value:"credit",className:"pt-4 space-y-4",children:[(0,a.jsxs)(C.z,{value:E,onValueChange:e=>V(e),className:"flex gap-4",children:[(0,a.jsxs)(b.J,{htmlFor:"fixed",className:"flex items-center gap-2 p-3 border rounded-md has-[:checked]:border-primary",children:[(0,a.jsx)(C.C,{value:"fixed",id:"fixed"}),(0,a.jsx)("span",{className:"font-bold",children:"LKR"})," Fixed"]}),(0,a.jsxs)(b.J,{htmlFor:"percentage",className:"flex items-center gap-2 p-3 border rounded-md has-[:checked]:border-primary",children:[(0,a.jsx)(C.C,{value:"percentage",id:"percentage"}),(0,a.jsx)(h.A,{className:"h-4 w-4"})," Percentage"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(b.J,{htmlFor:"discount-value",children:"fixed"===E?"Credit Amount (LKR)":"Discount Percentage (%)"}),(0,a.jsx)(j.p,{id:"discount-value",type:"number",value:H,onChange:e=>O(Number(e.target.value))})]})]}),(0,a.jsx)(w.av,{value:"free-item",className:"pt-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(b.J,{htmlFor:"free-item-select",children:"Select Menu Item"}),(0,a.jsxs)(v.l6,{value:T,onValueChange:Z,children:[(0,a.jsx)(v.bq,{id:"free-item-select",children:(0,a.jsx)(v.yv,{placeholder:"Select a free item"})}),(0,a.jsx)(v.gC,{children:null==M?void 0:M.map(e=>(0,a.jsxs)(v.eb,{value:e.id,children:[e.name," - LKR ",e.price.toFixed(2)]},e.id))})]})]})})]}),(0,a.jsxs)(g.Es,{children:[(0,a.jsx)(p.$,{variant:"outline",onClick:()=>Y(!1),children:"Cancel"}),(0,a.jsx)(p.$,{onClick:K,children:"Give Reward"})]})]})})]})}},30356:(e,t,s)=>{s.d(t,{C:()=>c,z:()=>d});var a=s(95155),r=s(12115),i=s(54059),l=s(70154),n=s(59434);let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.bL,{className:(0,n.cn)("grid gap-2",s),...r,ref:t})});d.displayName=i.bL.displayName;let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.q7,{ref:t,className:(0,n.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...r,children:(0,a.jsx)(i.C1,{className:"flex items-center justify-center",children:(0,a.jsx)(l.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});c.displayName=i.q7.displayName},59409:(e,t,s)=>{s.d(t,{bq:()=>f,eb:()=>p,gC:()=>x,l6:()=>o,yv:()=>u});var a=s(95155),r=s(12115),i=s(43433),l=s(79556),n=s(77381),d=s(10518),c=s(59434);let o=i.bL;i.YJ;let u=i.WT,f=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(i.l9,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...n,children:[r,(0,a.jsx)(i.In,{asChild:!0,children:(0,a.jsx)(l.A,{className:"h-4 w-4 opacity-50"})})]})});f.displayName=i.l9.displayName;let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.PP,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(n.A,{className:"h-4 w-4"})})});m.displayName=i.PP.displayName;let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.wn,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(l.A,{className:"h-4 w-4"})})});h.displayName=i.wn.displayName;let x=r.forwardRef((e,t)=>{let{className:s,children:r,position:l="popper",...n}=e;return(0,a.jsx)(i.ZL,{children:(0,a.jsxs)(i.UC,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...n,children:[(0,a.jsx)(m,{}),(0,a.jsx)(i.LM,{className:(0,c.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(h,{})]})})});x.displayName=i.UC.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.JU,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=i.JU.displayName;let p=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(i.q7,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(i.VF,{children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})}),(0,a.jsx)(i.p4,{children:r})]})});p.displayName=i.q7.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.wv,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=i.wv.displayName},62523:(e,t,s)=>{s.d(t,{p:()=>l});var a=s(95155),r=s(12115),i=s(59434);let l=r.forwardRef((e,t)=>{let{className:s,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...l})});l.displayName="Input"}}]);