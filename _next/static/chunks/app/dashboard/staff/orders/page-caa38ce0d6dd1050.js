(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2852],{3561:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(40157).A)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]])},14590:(e,t,r)=>{"use strict";r.d(t,{default:()=>x});var s=r(95155),n=r(90767),a=r(35317),d=r(66695),i=r(85127),c=r(44838),o=r(30285),l=r(3561),u=r(26126),p=r(87481),h=r(68856),f=r(12115),m=r(93436);function x(){let e=(0,n.jt)(),{toast:t}=(0,p.dj)(),[r,x]=(0,f.useState)(!1),j=(0,n.$e)(()=>e?(0,a.P)((0,a.rJ)(e,"orders"),(0,a.My)("orderDate","desc")):null,[e]),{data:y,isLoading:v}=(0,n.Ge)(j),g=(0,n.$e)(()=>e?(0,a.rJ)(e,"users"):null,[e]),{data:b,isLoading:w}=(0,n.Ge)(g),k=(0,f.useMemo)(()=>b?b.reduce((e,t)=>(e[t.id]=t.name,e),{}):{},[b]);(0,f.useEffect)(()=>{if(!j)return;let e=!0,t=(0,a.aQ)(j,t=>{if(e){e=!1;return}t.docChanges().forEach(e=>{"added"===e.type&&"Placed"===e.doc.data().status&&x(!0)})});return()=>t()},[j]),(0,f.useEffect)(()=>{if(r){let e=setTimeout(()=>x(!1),1e3);return()=>clearTimeout(e)}},[r]);let N=async(r,s)=>{if(!e)return;let d=(0,a.wP)(e),i=(0,a.H9)(e,"orders",r.id),c=(0,a.H9)(e,"users/".concat(r.customerId,"/orders"),r.id),o=(0,a.H9)(e,"users",r.customerId);if(d.update(i,{status:s}),d.update(c,{status:s}),"Completed"===s&&"Completed"!==r.status){let t=r.pointsToEarn||0,s={orderCount:(0,a.GV)(1)};if(t>0){s.loyaltyPoints=(0,a.GV)(t),s.lifetimePoints=(0,a.GV)(t);let n=(0,a.H9)((0,a.rJ)(e,"users/".concat(r.customerId,"/point_transactions"))),i={date:(0,a.O5)(),description:"Earned from Order #".concat(r.id.substring(0,7).toUpperCase()),amount:t,type:"earn"};d.set(n,i)}d.update(o,s)}if("Rejected"===s&&"Rejected"!==r.status){let t=r.pointsRedeemed||0;if(t>0){d.update(o,{loyaltyPoints:(0,a.GV)(t)});let s=(0,a.H9)((0,a.rJ)(e,"users/".concat(r.customerId,"/point_transactions"))),n={date:(0,a.O5)(),description:"Refund for Rejected Order #".concat(r.id.substring(0,7).toUpperCase()),amount:t,type:"earn"};d.set(s,n)}if(r.birthdayDiscountApplied){let e=r.birthdayDiscountApplied,t={};"free-item"===e.type?t.birthdayFreebieMenuItemIds=e.menuItemIds:(t.birthdayDiscountType=e.type,t.birthdayDiscountValue=e.value),d.update(o,t)}}d.commit().then(()=>{t({title:"Order Status Updated",description:"Order ".concat(r.id.substring(0,7)," is now ").concat(s,".")})}).catch(e=>{let r=new n.$9({path:c.path,operation:"update",requestResourceData:{status:s}});n.de.emit("permission-error",r),t({variant:"destructive",title:"Update Failed",description:"Could not update the order status. Check permissions."})})},R=e=>{switch(e){case"Placed":case"Completed":default:return"secondary";case"Accepting":case"Processing":return"outline";case"Ready for Pickup":return"default";case"Rejected":return"destructive"}},C=e=>{switch(e){case"Dine-in":return"default";case"Takeaway":return"outline";default:return"secondary"}};return v||w?(0,s.jsxs)(d.Zp,{children:[(0,s.jsxs)(d.aR,{children:[(0,s.jsx)(h.E,{className:"h-8 w-1/3"}),(0,s.jsx)(h.E,{className:"h-4 w-2/3 mt-2"})]}),(0,s.jsx)(d.Wu,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(h.E,{className:"h-12 w-full"}),(0,s.jsx)(h.E,{className:"h-16 w-full"}),(0,s.jsx)(h.E,{className:"h-16 w-full"})]})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.A,{shouldPlay:r,soundUrl:"https://www.soundjay.com/button/sounds/button-1.mp3",resetCondition:null==y?void 0:y.length}),(0,s.jsxs)(d.Zp,{children:[(0,s.jsxs)(d.aR,{children:[(0,s.jsx)(d.ZB,{children:"Incoming Orders"}),(0,s.jsx)(d.BT,{children:"Manage and update the status of customer orders."})]}),(0,s.jsxs)(d.Wu,{children:[(0,s.jsxs)(i.XI,{children:[(0,s.jsx)(i.A0,{children:(0,s.jsxs)(i.Hj,{children:[(0,s.jsx)(i.nd,{children:"Order ID"}),(0,s.jsx)(i.nd,{children:"Date"}),(0,s.jsx)(i.nd,{children:"Customer"}),(0,s.jsx)(i.nd,{children:"Type / Table"}),(0,s.jsx)(i.nd,{children:"Items"}),(0,s.jsx)(i.nd,{children:"Total"}),(0,s.jsx)(i.nd,{children:"Status"}),(0,s.jsx)(i.nd,{className:"text-right",children:"Actions"})]})}),(0,s.jsx)(i.BF,{children:null==y?void 0:y.map(e=>{var t;return(0,s.jsxs)(i.Hj,{className:"Completed"===e.status||"Rejected"===e.status?"opacity-60":"",children:[(0,s.jsx)(i.nA,{className:"font-medium",children:e.id.substring(0,7).toUpperCase()}),(0,s.jsx)(i.nA,{children:e.orderDate?new Date(e.orderDate.toDate()).toLocaleString():"N/A"}),(0,s.jsx)(i.nA,{children:k[e.customerId]||e.customerId.substring(0,7)}),(0,s.jsx)(i.nA,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)(u.E,{variant:C(e.orderType),children:e.orderType||"N/A"}),e.tableNumber&&(0,s.jsxs)("span",{className:"text-sm font-medium",children:["Table: ",e.tableNumber]})]})}),(0,s.jsx)(i.nA,{children:(0,s.jsx)("div",{className:"flex flex-col gap-1 text-xs",children:null==(t=e.orderItems)?void 0:t.map((e,t)=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{className:"font-semibold",children:[e.quantity,"x ",e.menuItemName]}),e.addons&&e.addons.length>0&&(0,s.jsx)("div",{className:"pl-2 text-muted-foreground",children:e.addons.map(e=>"+ ".concat(e.addonName)).join(", ")})]},t))})}),(0,s.jsxs)(i.nA,{children:["LKR ",e.totalAmount.toFixed(2)]}),(0,s.jsx)(i.nA,{children:(0,s.jsx)(u.E,{variant:R(e.status),children:e.status})}),(0,s.jsx)(i.nA,{className:"text-right",children:(0,s.jsxs)(c.rI,{children:[(0,s.jsx)(c.ty,{asChild:!0,children:(0,s.jsx)(o.$,{size:"icon",variant:"ghost",disabled:"Completed"===e.status||"Rejected"===e.status,children:(0,s.jsx)(l.A,{className:"h-4 w-4"})})}),(0,s.jsxs)(c.SQ,{children:["Placed"===e.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c._2,{onClick:()=>N(e,"Accepting"),children:"Accept Order"}),(0,s.jsx)(c.mB,{}),(0,s.jsx)(c._2,{className:"text-destructive",onClick:()=>N(e,"Rejected"),children:"Reject Order"})]}),"Accepting"===e.status&&(0,s.jsx)(c._2,{onClick:()=>N(e,"Processing"),children:"Mark as Processing"}),"Processing"===e.status&&(0,s.jsx)(c._2,{onClick:()=>N(e,"Ready for Pickup"),children:"Mark as Ready for Pickup"}),"Ready for Pickup"===e.status&&(0,s.jsx)(c._2,{onClick:()=>N(e,"Completed"),children:"Mark as Completed"})]})]})})]},e.id)})})]}),(null==y?void 0:y.length)===0&&(0,s.jsx)("div",{className:"text-center text-muted-foreground py-8",children:"No orders found."})]})]})]})}},26126:(e,t,r)=>{"use strict";r.d(t,{E:()=>i});var s=r(95155);r(12115);var n=r(74466),a=r(59434);let d=(0,n.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:r,...n}=e;return(0,s.jsx)("div",{className:(0,a.cn)(d({variant:r}),t),...n})}},46662:(e,t,r)=>{Promise.resolve().then(r.bind(r,25969)),Promise.resolve().then(r.bind(r,14590))},54059:(e,t,r)=>{"use strict";r.d(t,{C1:()=>M,bL:()=>F,q7:()=>H});var s=r(12115),n=r(85185),a=r(6101),d=r(46081),i=r(63540),c=r(89196),o=r(5845),l=r(94315),u=r(11275),p=r(45503),h=r(28905),f=r(95155),m="Radio",[x,j]=(0,d.A)(m),[y,v]=x(m),g=s.forwardRef((e,t)=>{let{__scopeRadio:r,name:d,checked:c=!1,required:o,disabled:l,value:u="on",onCheck:p,form:h,...m}=e,[x,j]=s.useState(null),v=(0,a.s)(t,e=>j(e)),g=s.useRef(!1),b=!x||h||!!x.closest("form");return(0,f.jsxs)(y,{scope:r,checked:c,disabled:l,children:[(0,f.jsx)(i.sG.button,{type:"button",role:"radio","aria-checked":c,"data-state":N(c),"data-disabled":l?"":void 0,disabled:l,value:u,...m,ref:v,onClick:(0,n.m)(e.onClick,e=>{c||null==p||p(),b&&(g.current=e.isPropagationStopped(),g.current||e.stopPropagation())})}),b&&(0,f.jsx)(k,{control:x,bubbles:!g.current,name:d,value:u,checked:c,required:o,disabled:l,form:h,style:{transform:"translateX(-100%)"}})]})});g.displayName=m;var b="RadioIndicator",w=s.forwardRef((e,t)=>{let{__scopeRadio:r,forceMount:s,...n}=e,a=v(b,r);return(0,f.jsx)(h.C,{present:s||a.checked,children:(0,f.jsx)(i.sG.span,{"data-state":N(a.checked),"data-disabled":a.disabled?"":void 0,...n,ref:t})})});w.displayName=b;var k=e=>{let{control:t,checked:r,bubbles:n=!0,...a}=e,d=s.useRef(null),i=(0,p.Z)(r),c=(0,u.X)(t);return s.useEffect(()=>{let e=d.current,t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(i!==r&&t){let s=new Event("click",{bubbles:n});t.call(e,r),e.dispatchEvent(s)}},[i,r,n]),(0,f.jsx)("input",{type:"radio","aria-hidden":!0,defaultChecked:r,...a,tabIndex:-1,ref:d,style:{...e.style,...c,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function N(e){return e?"checked":"unchecked"}var R=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],C="RadioGroup",[A,E]=(0,d.A)(C,[c.RG,j]),P=(0,c.RG)(),I=j(),[D,G]=A(C),O=s.forwardRef((e,t)=>{let{__scopeRadioGroup:r,name:s,defaultValue:n,value:a,required:d=!1,disabled:u=!1,orientation:p,dir:h,loop:m=!0,onValueChange:x,...j}=e,y=P(r),v=(0,l.jH)(h),[g,b]=(0,o.i)({prop:a,defaultProp:n,onChange:x});return(0,f.jsx)(D,{scope:r,name:s,required:d,disabled:u,value:g,onValueChange:b,children:(0,f.jsx)(c.bL,{asChild:!0,...y,orientation:p,dir:v,loop:m,children:(0,f.jsx)(i.sG.div,{role:"radiogroup","aria-required":d,"aria-orientation":p,"data-disabled":u?"":void 0,dir:v,...j,ref:t})})})});O.displayName=C;var T="RadioGroupItem",_=s.forwardRef((e,t)=>{let{__scopeRadioGroup:r,disabled:d,...i}=e,o=G(T,r),l=o.disabled||d,u=P(r),p=I(r),h=s.useRef(null),m=(0,a.s)(t,h),x=o.value===i.value,j=s.useRef(!1);return s.useEffect(()=>{let e=e=>{R.includes(e.key)&&(j.current=!0)},t=()=>j.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",t)}},[]),(0,f.jsx)(c.q7,{asChild:!0,...u,focusable:!l,active:x,children:(0,f.jsx)(g,{disabled:l,required:o.required,checked:x,...p,...i,name:o.name,ref:m,onCheck:()=>o.onValueChange(i.value),onKeyDown:(0,n.m)(e=>{"Enter"===e.key&&e.preventDefault()}),onFocus:(0,n.m)(i.onFocus,()=>{var e;j.current&&(null==(e=h.current)||e.click())})})})});_.displayName=T;var L=s.forwardRef((e,t)=>{let{__scopeRadioGroup:r,...s}=e,n=I(r);return(0,f.jsx)(w,{...n,...s,ref:t})});L.displayName="RadioGroupIndicator";var F=O,H=_,M=L},70831:(e,t,r)=>{"use strict";r.d(t,{f:()=>a});var s=r(35476),n=r(92084);function a(e,t){let r=(0,s.a)(e);return isNaN(t)?(0,n.w)(e,NaN):(t&&r.setDate(r.getDate()+t),r)}},93436:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(12115);function n(e){let{shouldPlay:t,soundUrl:r,resetCondition:n}=e,a=(0,s.useRef)(null),d=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{a.current=new Audio(r),a.current.preload="auto"},[r]),(0,s.useEffect)(()=>{t&&!d.current&&a.current&&(a.current.play().catch(e=>{console.warn("Audio play failed. This can happen if the user hasn't interacted with the page yet.",e)}),d.current=!0)},[t]),(0,s.useEffect)(()=>{d.current=!1},[n]),null}}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,7416,1648,1790,332,5152,1224,3013,2703,3421,6062,3547,7505,5969,8441,1684,7358],()=>t(46662)),_N_E=e.O()}]);